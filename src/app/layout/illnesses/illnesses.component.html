<div [@routerTransition]>
  <section class="tables">
    <div class="container-fluid">
      <div class="col-lg-12">
        <div class="card">
          <div class="card-header d-flex align-items-center justify-content-between">
            <h3 class="h4">
              <i class="fa fa-heartbeat"></i> Enfermedades &nbsp;&nbsp;
              <button class="btn btn-success" (click)="openModal(addTemplate)">
                <i class="fa fa-plus"></i> Nuevo
              </button>
            </h3>
            <div class="search-bar">
              <form role="form" class="form-inline" #searchForm="ngForm">
                <input (ngModelChange)="search($event)" class="form-control" type="text" placeholder="Buscar" name="searchString" [(ngModel)]="searchString">
              </form>
            </div>
          </div>

          <div class="card-body">
            <table class="table">
              <thead>
                <tr>
                  <th>Nombre</th>
                  <th>Medicina</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let illness of illnesses" (click)="openModal(infoTemplate,illness)">
                  <td>
                    {{ illness.name }}
                  </td>
                  <td>{{ illness.medicine }}</td>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="card-footer">
            <div class="row">
              <div class="col"></div>
              <div class="col align-self-center">
                <pagination [itemsPerPage]="itemsPerPage" [totalItems]="totalItems" (pageChanged)="pageChanged($event)" previousText="&lsaquo;"
                  nextText="&rsaquo;"></pagination>
              </div>
              <div class="col"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
</div>

<ng-template #addTemplate>
  <div class="modal-header">
    <h4 class="modal-title pull-left">{{(!illness.id)? 'Agregar enfermedad' : 'Editar enfermedad'}}</h4>
    <button type="button" class="close pull-right" aria-label="Close" (click)="modalRef.hide()">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <ul>
      <li *ngFor="let message of errorMessage">
        {{ message }}
      </li>
    </ul>
    <form role="form" #addIllnessForm>
      <fieldset class="form-group">
        <label>Nombre</label>
        <input class="form-control" name="nombre" [(ngModel)]="illness.name">
      </fieldset>

      <fieldset class="form-group">
        <label>Dosis</label>
        <input class="form-control" name="dosis" [(ngModel)]="illness.dosage">
      </fieldset>

      <fieldset class="form-group">
        <label>Info</label>
        <input class="form-control" name="info" [(ngModel)]="illness.moreInfo">
      </fieldset>
      <fieldset class="form-group">
        <label>Medicamentos</label>
        <input class="form-control" name="medicine" [(ngModel)]="illness.medicine">
      </fieldset>
    </form>
  </div>
  <div class="modal-footer">
    <button (click)="submitModal()" class="btn btn-primary">{{(!illness.id)? 'Agregar' : 'Guardar'}}</button>
  </div>
</ng-template>

<ng-template #infoTemplate>
  <div class="modal-header">
    <h4 class="modal-title pull-left">Info</h4>
    <div class="btn-group pull-right" placement="bottom left" dropdown>
      <a href="javascript:void(0)" dropdownToggle class="dropdown-toggle">
        <i class="fa fa-ellipsis-v"></i>
      </a>
      <ul *dropdownMenu class="dropdown-menu dropdown-menu-right" role="menu">
        <li role="menuitem">
          <a (click)="openModal(addTemplate,illness)" class="dropdown-item" href="javascript:void(0)">Editar</a>
        </li>
        <li role="menuitem">
          <a (click)="openModal(confirmTemplate,illness)" class="dropdown-item" href="javascript:void(0)">Eliminar</a>
        </li>
        <li role="menuitem">
           <a (click)="modalRef.hide()" class="dropdown-item" href="javascript:void(0)">Cerrar</a>
        </li>
      </ul>
    </div>
  </div>
  <div class="modal-body">
    <div class="row justify-content-center">
        <div>
            <div>
              <b>Nombre: </b> {{ illness.name }}</div>
            <br>
            <div>
              <b>Medicamento: </b>{{ illness.medicine }}</div>
            <br>
            <div>
              <b>info: </b>{{ illness.moreInfo }}</div>
            <br>
            <div>
              <b>Dosis: </b>{{ illness.dosage }}</div>
          </div>
        </div>
    </div>
</ng-template>

<ng-template #confirmTemplate>
  <div class="modal-header">
    <p>
      <i class="fa fa-exclamation"></i>Alerta</p>
  </div>
  <div class="modal-body">
    ¿Está seguro que desea eliminar la enfermedad {{ illness.name }}?
  </div>
  <div class="modal-footer">
    <button class="btn btn-danger" (click)="removeIllness()">Si</button>
    <button class="btn btn-default" (click)="modalRef.hide()">No</button>
  </div>
</ng-template>